#
#   Script detecting nVidia Bus ID
#
DETECTED="UNDEFINED"
if [ `${LSPCI} | grep -c VGA` -eq 2 ]; then
    DETECTED=`${LSPCI} | grep VGA | grep nVidia | awk '{ print "PCI:"$1 }' | sed s/\\\./:/g`
elif [ `${LSPCI} | grep -c 3D` -eq 1 ]; then
    DETECTED=`${LSPCI} | grep 3D  | grep nVidia | awk '{ print "PCI:"$1 }' | sed s/\\\./:/g`
fi

if [ "$DETECTED" = "UNDEFINED" ]; then

    echo
    echo "The BusID of the nVidia card can't be determined."
    echo
    echo "You must correct this manually in /etc/X11/xorg.conf.nvidia."
    echo "Please report this problem.."
    echo
    echo "Press Any Key to continue."
    echo
    read

else

    echo
    echo "We will use the local configuration ${DETECTED}"
    echo "for the BusID of the nVidia card."
    echo
    NVIDIABUSID=${DETECTED}

fi

sed -i 's/REPLACEWITHBUSID/'$NVIDIABUSID'/g' /etc/X11/xorg.conf.nvidia
